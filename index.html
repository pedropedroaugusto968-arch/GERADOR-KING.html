<script>
    // FUNÇÃO PARA VERIFICAR SE A SESSÃO AINDA É VÁLIDA AO ABRIR O SITE
    window.onload = function() {
        const expiraEm = localStorage.getItem('king_expira');
        if (expiraEm) {
            const agora = new Date().getTime();
            if (agora > parseInt(expiraEm)) {
                localStorage.clear(); // Apaga tudo se o tempo acabou
                alert("SUA LICENÇA EXPIROU! ADQUIRA UMA NOVA KEY.");
                location.reload();
            } else {
                // Se ainda for válida, pode pular o login se quiser, ou apenas deixar logar
            }
        }
    };

    function verificarAcesso() {
        const key = document.getElementById('key-input').value.trim().toUpperCase();
        const erro = document.getElementById('msg-erro');
        
        const regex = /^K(1|5|10|30)-[0-9]{3}$/;

        if (regex.test(key)) {
            const dias = parseInt(key.split('-')[0].replace('K', ''));
            const hardwareID = navigator.userAgent + screen.width;
            const registrado = localStorage.getItem('lock_' + key);

            if (registrado && registrado !== hardwareID) {
                erro.innerText = "ERRO: KEY JÁ USADA EM OUTRO CELULAR!";
                erro.style.display = 'block';
            } else {
                // --- SISTEMA DE TEMPO ---
                const dataAtual = new Date();
                // Calcula o tempo de expiração (Dias * 24 horas * 60 min * 60 seg * 1000 ms)
                const tempoExpiracao = dataAtual.getTime() + (dias * 24 * 60 * 60 * 1000);
                
                localStorage.setItem('lock_' + key, hardwareID);
                localStorage.setItem('king_expira', tempoExpiracao);
                localStorage.setItem('key_ativa', key);
                
                abrirGerador(dias);
            }
        } else {
            erro.style.display = 'block';
            setTimeout(() => erro.style.display = 'none', 3000);
        }
    }

    function abrirGerador(dias) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('sensi-screen').style.display = 'block';
        
        // Mostrar quanto tempo falta
        const expira = parseInt(localStorage.getItem('king_expira'));
        const falta = Math.ceil((expira - new Date().getTime()) / (1000 * 60 * 60 * 24));
        
        document.getElementById('plano-tag').innerText = "LICENÇA ATIVA: " + falta + " DIA(S) RESTANTE(S)";
        window.planoAtual = dias;
    }

    // ... (mantenha a função de injetarSensi e o Matrix igual) ...
</script>
